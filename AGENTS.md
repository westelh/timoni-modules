# Repository Guidelines

## Project Structure & Module Organization
This repo is a collection of Timoni modules, each in its own top-level directory (for example, `acme-issuer/`, `vault-connection/`). A typical module contains:
- `timoni.cue` for module entry points and configuration wiring.
- `values.cue` for concrete default values (often generated).
- `templates/` for Kubernetes resource templates.
- `cue.mod/` for vendored CUE dependencies and generated schemas.
Module-specific documentation lives in each module’s `README.md`.

## Build, Test, and Development Commands
Use Timoni to validate and deploy modules locally:
- `timoni mod vet ./<module>` to validate a module’s CUE definitions.
- `timoni -n <namespace> apply <name> oci://<registry>/<module>` to install a module instance.
- `timoni -n <namespace> delete <name>` to uninstall an instance.
For examples of values overrides and installation, see a module’s `README.md`.

## Coding Style & Naming Conventions
Primary language is CUE. Follow standard CUE formatting (`cue fmt`) and keep generated files intact:
- `values.cue` is generated by Timoni; change defaults in source templates or generation inputs instead of editing it directly.
- Keep module directories lower-case and hyphenated (for example, `vault-static-secret`).
Template files are in `templates/*.cue` and should remain concise and declarative.

## Testing Guidelines
There is no dedicated unit test suite in this repository. Use `timoni mod vet ./<module>` as the primary validation step before changes. If you introduce new templates or schemas, validate them by running `timoni mod vet` for the affected module.

## Commit & Pull Request Guidelines
Commit history favors Conventional Commit-style messages like `feat(vault-connection): add module` or `fix(ci): accept <module>/<version> tags`. Match this pattern when possible.
For pull requests:
- Include a brief summary of the module(s) touched and the rationale.
- Note any required Kubernetes dependencies (CRDs, controllers) and how to validate.
- If the change affects publishing, mention the expected tag format.

## Release & Publishing Notes
Publishing is tag-driven via GitHub Actions. Tags must be in the form `<module>/<version>`; a leading `v` in the version is allowed and will be stripped (for example, `acme-issuer/v1.2.3`). The workflow runs `timoni mod vet` and publishes to GHCR, setting OCI annotations to the module subpath for the tag (for example, `.../tree/<module>/<version>/<module>`).
